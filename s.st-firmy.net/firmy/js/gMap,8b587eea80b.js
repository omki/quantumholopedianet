var mapList={mapMinHeight:436,mapWindowHeightPercentage:74,fadeCoverTime:300,activeMarkerZoom:12,maxZIndex:1E4,pageToLoadLimit:5,firstOpen:!1,mapOpen:!1,mapLoaded:!1,mapLoading:!1,companiesAjax:!1,initialZoomChecked:!1,THIS:{},cp:{},map:{},companies:{},markerImg:cfg["static"]+"/gfx/marker.png",markerActiveImg:cfg["static"]+"/gfx/marker-active.png",clusterImg:cfg["static"]+"/gfx/marker-cluster.png",markerImgRetina:cfg["static"]+"/gfx/marker@2x.png",markerActiveImgRetina:cfg["static"]+"/gfx/marker-active@2x.png",clusterImgRetina:cfg["static"]+"/gfx/marker-cluster@2x.png",mapInitHeight:0,currentMarkerActive:0,mapHeight:0,currentMarkerActiveId:0,initialZoom:0,requestIterarion:0,currentCompanies:[],markers:[],listHtml:"",GALabel:"gmap",run:function(){THIS=this;THIS.binds();THIS.setMapHeight();"undefined"!=typeof cfg.isRetina&&!0==cfg.isRetina&&(THIS.markerImg=THIS.markerImgRetina,THIS.markerActiveImg=THIS.markerActiveImgRetina,THIS.clusterImg=THIS.clusterImgRetina);""!=location.hash&&(THIS.hashArray=location.hash.split(","),"#mapa"==THIS.hashArray[0]&&(THIS.showMap(),THIS.currentMarkerActiveId=parseInt(THIS.hashArray[2]),THIS.activeMarkerZoom=parseInt(THIS.hashArray[3])),$(function(){1<THIS.hashArray[1]&&$("#map-nav").attr("data-next",$("#map-nav").attr("data-next")+"&p="+THIS.hashArray[1])}))},initOverLay:function(){labelOverlay()},setMapHeight:function(){THIS.mapInitHeight=$("#map-full-wrapper").height();THIS.mapHeight=$(window).height()*THIS.mapWindowHeightPercentage/100;THIS.mapHeight<THIS.mapMinHeight&&(THIS.mapHeight=THIS.mapMinHeight);$("#map-full-inner").height(THIS.mapHeight)},addMarker:function(a){var b=new MarkerWithLabel({position:new google.maps.LatLng(a.lat,a.lon),icon:new google.maps.MarkerImage(THIS.markerImg,null,null,null,new google.maps.Size(34,44)),map:THIS.map,labelContent:a.pos,labelAnchor:new google.maps.Point(16,100<a.pos?36:40),labelClass:"labels"+(100<a.pos?" small":""),labelStyle:{opacity:1},labelInBackground:!1});google.maps.event.addListener(b,"click",function(){GA.event("mapa-pinezka",structure,THIS.GALabel);THIS.activeMarkerZoom=THIS.map.getZoom();THIS.activateMarker(a.pos);THIS.setMarkerUrl(a);$(".map-bar").offset().top<$(window).scrollTop()&&scrollToObj(".map-bar")});a.marker=b},dezactiveMarker:function(){"object"==typeof THIS.currentMarkerActive&&THIS.currentMarkerActive.setIcon(new google.maps.MarkerImage(THIS.markerImg,null,null,null,new google.maps.Size(34,44)))},activateMarker:function(a){"number"==typeof a&&"undefined"!=typeof THIS.currentCompanies[a]&&(a=THIS.currentCompanies[a],THIS.dezactiveMarker(),THIS.currentMarkerActive=a.marker,a.marker.setZIndex(++THIS.maxZIndex),a.marker.setIcon(new google.maps.MarkerImage(THIS.markerActiveImg,null,null,null,new google.maps.Size(34,44))),THIS.chooseCompany(a))},setMarkerUrl:function(a){var b=location.hash,d=1;location.search.split("&");""!=b&&(pageTmp=b.split(","),d=1<pageTmp[1]?pageTmp[1]:1);location.hash="#mapa,"+d+","+a.pos+","+THIS.map.getZoom()},Markers:function(a){for(i in a)a[i].marker.setMap(null);THIS.centerMap()},binds:function(){var a=decodeURIComponent(window.location.href),a=a.replace(/[&\?]p=\d*/gi,"");a.match(/\?/)||(a=a.replace(/&/,"?"));$("#nav-zoom .zoom-in").click(function(){THIS.map.setZoom(THIS.map.getZoom()+1);GA.event("mapa-przybliz",structure,THIS.GALabel)});$("#nav-zoom .zoom-out").click(function(){THIS.map.setZoom(THIS.map.getZoom()-1);GA.event("mapa-oddal",structure,THIS.GALabel)});$("#map-full .map-cover, #map-full .show-map, #map-full .show-map-link").click(function(){!0==THIS.mapOpen?THIS.hideMap():THIS.showMap()});$("#map-nav").click(function(){!1==THIS.companiesAjax&&(GA.event("mapa-zobacz-wiecej-firm",structure,THIS.GALabel),THIS.closeBar(),THIS.getCompanies())})},closeBar:function(){THIS.currentMarkerActiveId=0;modules.list.closeBar()},getUrl:function(){var a=$("#map-nav").attr("data-next");null==a.match(/map/)&&(a=null!=a.match(/\?p=/)?a.replace("?p=","?map&p="):null==a.match(/&p=/)?a+"&map":a.replace("&p=","&map&p="));return a},setNextUrl:function(){var a=$("#map-nav").attr("data-next"),a=null==a.match(/&p=/)?a+"&p=1":a.replace(/&p=\d+/,"&p="+THIS.requestIterarion);$("#map-nav").attr("data-next",a)},getCompanies:function(){var a=this.getUrl();$("#map-nav .map-more-companies").appendLoader();THIS.companiesAjax=!0;$.ajax({url:a,success:function(a){THIS.requestIterarion++;var d=0;if(!1==THIS.mapLoaded){var e={},e="undefined"!=typeof a.ModuleSearch?a.ModuleSearch:a.ModuleList;modules.list.setCompanies(e.companiesObject);THIS.assignCurrentCompanies(modules.list.getCompanies());THIS.listHtml=e.html}else modules.parseResponse(a),THIS.listHtml="";if(!1==THIS.firstOpen&&"undefined"!=typeof THIS.hashArray&&"undefined"!=typeof THIS.hashArray[1]&&"undefined"!=THIS.hashArray[2]&&THIS.hashArray[1]<=THIS.pageToLoadLimit&&1<parseInt(THIS.hashArray[1])&&THIS.requestIterarion<THIS.hashArray[1])return THIS.setNextUrl(),THIS.getCompanies(),!0;$("#map-nav .map-more-companies").removeLoader();if("undefined"!=typeof a.ModuleList||"undefined"!=typeof a.ModuleSearch)d=a.ModuleSearch?a.ModuleSearch.companiesObject.length:a.ModuleList.companiesObject.length;"undefined"!=typeof a.PaginationList&&(e=a.PaginationList.nextLink,$("#map-nav").attr("data-next",e));e="";d&&"undefined"!=typeof a.PaginationList&&!0==a.PaginationList.showNext?(e="+"+d,$("#map-nav .map-more-companies").html(e)):!1==THIS.firstOpen?$("#map-nav").hide():($("#map-nav .map-more-companies").html("-"),$("#map-nav").fadeOut(250));""==location.hash?location.hash="#mapa":!0==THIS.firstOpen&&"undefined"!=typeof a.PaginationList.current&&1<a.PaginationList.current&&(location.hash="#mapa,"+a.PaginationList.current);!1==THIS.firstOpen&&(THIS.firstOpen=!0,THIS.load());THIS.companiesAjax=!1}})},actualizeMoreCompaniesContainer:function(a){a=parseInt(a);var b="";a?b="+"+a:(b="-",$("#map-nav").unbind("click"));$("#map-nav .map-more-companies").html(b)},chooseCompany:function(a){modules.list.getCompanyForBar(a)},assignCurrentCompanies:function(a){THIS.currentCompanies=[];for(c in a)THIS.currentCompanies[a[c].pos]=a[c]},showMap:function(){if(THIS.mapOpen)return!1;"#mapa"!=location.hash.substring(0,5)&&(location.hash="#mapa");GA.event("mapa-odslon",structure,THIS.GALabel);if(!1==THIS.mapLoading){if(!0==THIS.mapLoaded&&(THIS.assignCurrentCompanies(modules.list.getCompanies()),0==THIS.currentCompanies.length))return!1;modules.list.barCloseCallback=function(){THIS.dezactiveMarker()};modules.list.setOnAddCompaniesCallback(function(a,b){!0==THIS.mapLoaded&&(THIS.assignCurrentCompanies(b),THIS.showCompanies(b))});modules.list.setOnRemoveCompaniesCallback(function(a){});THIS.mapLoading=!0;!1==THIS.mapLoaded?$("#map-full .show-map-link").fadeOut(200,function(){$(".map-cover").appendLoader("loaderDivSmallMain loaderDivMapMain");THIS.getCompanies()}):$("#map-full .show-map-link").fadeOut(200,function(){$(".map-cover").fadeOut(THIS.fadeCoverTime,function(){$("#map-full-wrapper").height(THIS.mapHeight);$("#map-full, #map-nav, #nav-zoom").addClass("active");THIS.mapOpen=!0;THIS.mapLoading=!1;THIS.showCompanies(THIS.currentCompanies)})})}},showCompanies:function(a){if("object"==typeof a&&a.length){for(i in a)THIS.addMarker(a[i]);THIS.markers=[];for(var b in THIS.currentCompanies)THIS.markers.push(THIS.currentCompanies[b].marker);"undefined"!=typeof markerCluster&&window.markerCluster.clearMarkers();window.markerCluster=new MarkerClusterer(THIS.map,THIS.markers,{styles:[{url:THIS.clusterImg,width:"37",height:"38",textColor:"#fff",textSize:15,anchor:[12,0],fontFamily:"open_sanssemibold,Arial,sans-serif",backgroundSize:"37px 38px"}],gridSize:40,maxZoom:13});google.maps.event.addListener(markerCluster,"clusterclick",function(){THIS.initialZoomChecked=!0;mapList.map.set("scrollwheel",!0)});0<THIS.currentMarkerActiveId?"undefined"!=typeof THIS.currentCompanies[THIS.currentMarkerActiveId]&&(THIS.activateMarker(THIS.currentMarkerActiveId),THIS.centerToCurrentMarker()):THIS.centerMap()}},mapIsOpen:function(){return THIS.mapOpen},centerToCurrentMarker:function(){var a=location.hash.split(",");THIS.activeMarkerZoom=parseInt(a[3]);a=THIS.currentMarkerActive;(new google.maps.LatLngBounds).extend(new google.maps.LatLng(a.getPosition().lat(),a.getPosition().lng()));a=new google.maps.LatLng(a.getPosition().lat(),a.getPosition().lng());THIS.map.setZoom(THIS.activeMarkerZoom);THIS.map.getBounds().contains(a)||THIS.map.panTo(a)},hideMap:function(){if(!THIS.mapOpen)return!1;"#mapa"==location.hash.substring(0,5)&&(!1==isIE()||9<isIE())&&window.history.pushState(null,null,location.href.replace(location.hash,""));GA.event("mapa-schowaj",structure,THIS.GALabel);THIS.mapOpen=!1;THIS.closeBar();$("#map-full, #map-nav, #nav-zoom").removeClass("active");$("#map-full-wrapper").height(THIS.mapInitHeight);setTimeout(function(){$("#map-full .show-map-link, .map-cover").fadeIn(THIS.fadeCoverTime);window.markerCluster.clearMarkers()},THIS.fadeCoverTime)},load:function(){var a=document.createElement("script");a.type="text/javascript";var b="";"undefined"!=typeof cfg.gmapKey&&""!=cfg.gmapKey&&(b="key="+cfg.gmapKey+"&");a.src="https://maps.googleapis.com/maps/api/js?"+b+"sensor=false&v=3.14&callback=mapList.initialize";document.body.appendChild(a)},initialize:function(){var a={center:new google.maps.LatLng(51.773118,19.4805928),zoom:6,minZoom:6,maxZoom:16,disableDefaultUI:!0,scrollwheel:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeId:google.maps.MapTypeId.ROADMAP};THIS.map=new google.maps.Map(document.getElementById("map-full-inner"),a);THIS.centerMap();google.maps.event.addListenerOnce(THIS.map,"tilesloaded",function(){THIS.initOverLay();THIS.showCompanies(THIS.currentCompanies);THIS.loaded()})},centerMap:function(){var a=[];for(d in THIS.currentCompanies)"undefined"!=typeof THIS.currentCompanies[d].lon&&"undefined"!=typeof THIS.currentCompanies[d].lat&&0!=THIS.currentCompanies[d].lon&&0!=THIS.currentCompanies[d].lat&&a.push(new google.maps.LatLng(THIS.currentCompanies[d].lat,THIS.currentCompanies[d].lon));for(var b=new google.maps.LatLngBounds,d=0;d<a.length;d++)b.extend(a[d]);THIS.map.fitBounds(b);THIS.initialZoom=THIS.map.getZoom()},loaded:function(){$(".map-cover").removeLoader(function(){modules.list.reloadList(THIS.listHtml);$(".map-cover").fadeOut(THIS.fadeCoverTime,function(){$("#map-full, #map-nav, #nav-zoom").addClass("active");$("#map-full-wrapper").height(THIS.mapHeight);THIS.mapOpen=!0;THIS.mapLoaded=!0;THIS.mapLoading=!1;THIS.initialZoom=THIS.map.getZoom();google.maps.event.addDomListener(THIS.map.getDiv(),"DOMMouseScroll",function(a){THIS.blockScroll(a)},!0);$("#map-nav").addClass("active")})})},blockScroll:function(a){if(!1==THIS.initialZoomChecked||THIS.initialZoom>=THIS.map.getZoom())0<a.detail&&mapList.map.set("scrollwheel",!1),THIS.initialZoomChecked=!0}};function labelOverlay(){window.inherits=function(a,b){function d(){}d.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new d;a.prototype.constructor=a};window.MarkerLabel_=function(a,b,d){this.marker_=a;this.handCursorURL_=a.handCursorURL;this.labelDiv_=document.createElement("div");this.labelDiv_.style.cssText="position: absolute; overflow: hidden;";this.eventDiv_=document.createElement("div");this.eventDiv_.style.cssText=this.labelDiv_.style.cssText;this.eventDiv_.setAttribute("onselectstart","return false;");this.eventDiv_.setAttribute("ondragstart","return false;");this.crossDiv_=MarkerLabel_.getSharedCross(b)};inherits(MarkerLabel_,google.maps.OverlayView);window.MarkerLabel_.getSharedCross=function(a){var b;"undefined"===typeof MarkerLabel_.getSharedCross.crossDiv&&(b=document.createElement("img"),b.style.cssText="position: absolute; z-index: 1000002; display: none;",b.style.marginLeft="-8px",b.style.marginTop="-9px",b.src=a,MarkerLabel_.getSharedCross.crossDiv=b);return MarkerLabel_.getSharedCross.crossDiv};window.MarkerLabel_.prototype.onAdd=function(){var a=this,b=!1,d=!1,e,f,h,m,k,p,q,r="url("+this.handCursorURL_+")",n=function(a){a.preventDefault&&a.preventDefault();a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()},s=function(){a.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_);this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_);"undefined"===typeof MarkerLabel_.getSharedCross.processed&&(this.getPanes().overlayImage.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=!0);this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())this.style.cursor="pointer",google.maps.event.trigger(a.marker_,"mouseover",b)}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(b){!a.marker_.getDraggable()&&!a.marker_.getClickable()||d||(this.style.cursor=a.marker_.getCursor(),google.maps.event.trigger(a.marker_,"mouseout",b))}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(e){d=!1;a.marker_.getDraggable()&&(b=!0,this.style.cursor=r);if(a.marker_.getDraggable()||a.marker_.getClickable())google.maps.event.trigger(a.marker_,"mousedown",e),n(e)}),google.maps.event.addDomListener(document,"mouseup",function(g){var f;b&&(b=!1,a.eventDiv_.style.cursor="pointer",google.maps.event.trigger(a.marker_,"mouseup",g));if(d){if(k){f=a.getProjection().fromLatLngToDivPixel(a.marker_.getPosition());f.y+=20;a.marker_.setPosition(a.getProjection().fromDivPixelToLatLng(f));try{a.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(s,1406)}catch(h){}}a.crossDiv_.style.display="none";a.marker_.setZIndex(e);m=!0;d=!1;g.latLng=a.marker_.getPosition();google.maps.event.trigger(a.marker_,"dragend",g)}}),google.maps.event.addListener(a.marker_.getMap(),"mousemove",function(g){var l;b&&(d?(g.latLng=new google.maps.LatLng(g.latLng.lat()-f,g.latLng.lng()-h),l=a.getProjection().fromLatLngToDivPixel(g.latLng),k&&(a.crossDiv_.style.left=l.x+"px",a.crossDiv_.style.top=l.y+"px",a.crossDiv_.style.display="",l.y-=20),a.marker_.setPosition(a.getProjection().fromDivPixelToLatLng(l)),k&&(a.eventDiv_.style.top=l.y+20+"px"),google.maps.event.trigger(a.marker_,"drag",g)):(f=g.latLng.lat()-a.marker_.getPosition().lat(),h=g.latLng.lng()-a.marker_.getPosition().lng(),e=a.marker_.getZIndex(),p=a.marker_.getPosition(),q=a.marker_.getMap().getCenter(),k=a.marker_.get("raiseOnDrag"),d=!0,a.marker_.setZIndex(1E6),g.latLng=a.marker_.getPosition(),google.maps.event.trigger(a.marker_,"dragstart",g)))}),google.maps.event.addDomListener(document,"keydown",function(b){d&&27===b.keyCode&&(k=!1,a.marker_.setPosition(p),a.marker_.getMap().setCenter(q),google.maps.event.trigger(document,"mouseup",b))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())m?m=!1:(google.maps.event.trigger(a.marker_,"click",b),n(b))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(b){if(a.marker_.getDraggable()||a.marker_.getClickable())google.maps.event.trigger(a.marker_,"dblclick",b),n(b)}),google.maps.event.addListener(this.marker_,"dragstart",function(a){d||(k=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(b){!d&&k&&(a.setPosition(20),a.labelDiv_.style.zIndex=1E6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(b){d||k&&a.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){a.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){a.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){a.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){a.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){a.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){a.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){a.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){a.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){a.setStyles()})]};window.MarkerLabel_.prototype.onRemove=function(){var a;this.labelDiv_.parentNode.removeChild(this.labelDiv_);this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(a=0;a<this.listeners_.length;a++)google.maps.event.removeListener(this.listeners_[a])};window.MarkerLabel_.prototype.draw=function(){this.setContent();this.setTitle();this.setStyles()};window.MarkerLabel_.prototype.setContent=function(){var a=this.marker_.get("labelContent");"undefined"===typeof a.nodeType?(this.labelDiv_.innerHTML=a,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(a),a=a.cloneNode(!0),this.eventDiv_.innerHTML="",this.eventDiv_.appendChild(a))};window.MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""};window.MarkerLabel_.prototype.setStyles=function(){var a,b;this.labelDiv_.className=this.marker_.get("labelClass");this.eventDiv_.className=this.labelDiv_.className;this.labelDiv_.style.cssText="";this.eventDiv_.style.cssText="";b=this.marker_.get("labelStyle");for(a in b)b.hasOwnProperty(a)&&(this.labelDiv_.style[a]=b[a],this.eventDiv_.style[a]=b[a]);this.setMandatoryStyles()};window.MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute";this.labelDiv_.style.overflow="hidden";"undefined"!==typeof this.labelDiv_.style.opacity&&""!==this.labelDiv_.style.opacity&&(this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+100*this.labelDiv_.style.opacity+')"',this.labelDiv_.style.filter="alpha(opacity="+100*this.labelDiv_.style.opacity+")");this.eventDiv_.style.position=this.labelDiv_.style.position;this.eventDiv_.style.overflow=this.labelDiv_.style.overflow;this.eventDiv_.style.opacity=0.01;this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"';this.eventDiv_.style.filter="alpha(opacity=1)";this.setAnchor();this.setPosition();this.setVisible()};window.MarkerLabel_.prototype.setAnchor=function(){var a=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-a.x+"px";this.labelDiv_.style.marginTop=-a.y+"px";this.eventDiv_.style.marginLeft=-a.x+"px";this.eventDiv_.style.marginTop=-a.y+"px"};window.MarkerLabel_.prototype.setPosition=function(a){var b=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());"undefined"===typeof a&&(a=0);this.labelDiv_.style.left=Math.round(b.x)+"px";this.labelDiv_.style.top=Math.round(b.y-a)+"px";this.eventDiv_.style.left=this.labelDiv_.style.left;this.eventDiv_.style.top=this.labelDiv_.style.top;this.setZIndex()};window.MarkerLabel_.prototype.setZIndex=function(){var a=this.marker_.get("labelInBackground")?-1:1;"undefined"===typeof this.marker_.getZIndex()?this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+a:this.labelDiv_.style.zIndex=this.marker_.getZIndex()+a;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex};window.MarkerLabel_.prototype.setVisible=function(){this.marker_.get("labelVisible")?this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none":this.labelDiv_.style.display="none";this.eventDiv_.style.display=this.labelDiv_.style.display};window.MarkerWithLabel=function(a){a=a||{};a.labelContent=a.labelContent||"";a.labelAnchor=a.labelAnchor||new google.maps.Point(0,0);a.labelClass=a.labelClass||"markerLabels";a.labelStyle=a.labelStyle||{};a.labelInBackground=a.labelInBackground||!1;"undefined"===typeof a.labelVisible&&(a.labelVisible=!0);"undefined"===typeof a.raiseOnDrag&&(a.raiseOnDrag=!0);"undefined"===typeof a.clickable&&(a.clickable=!0);"undefined"===typeof a.draggable&&(a.draggable=!1);"undefined"===typeof a.optimized&&(a.optimized=!1);a.crossImage=a.crossImage||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png";a.handCursor=a.handCursor||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur";a.optimized=!1;this.label=new MarkerLabel_(this,a.crossImage,a.handCursor);google.maps.Marker.apply(this,arguments)};inherits(MarkerWithLabel,google.maps.Marker);window.MarkerWithLabel.prototype.setMap=function(a){google.maps.Marker.prototype.setMap.apply(this,arguments);this.label.setMap(a)}}function MarkerClusterer(a,b,d){this.extend(MarkerClusterer,google.maps.OverlayView);this.map_=a;this.markers_=[];this.clusters_=[];this.sizes=[53,56,66,78,90];this.styles_=[];this.ready_=!1;d=d||{};this.gridSize_=d.gridSize||60;this.minClusterSize_=d.minimumClusterSize||2;this.maxZoom_=d.maxZoom||null;this.styles_=d.styles||[];this.imagePath_=d.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_;this.imageExtension_=d.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_;this.zoomOnClick_=!0;void 0!=d.zoomOnClick&&(this.zoomOnClick_=d.zoomOnClick);this.averageCenter_=!1;void 0!=d.averageCenter&&(this.averageCenter_=d.averageCenter);this.setupStyles_();this.setMap(a);this.prevZoom_=this.map_.getZoom();var e=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var a=e.map_.getZoom(),b=e.map_.minZoom||0,d=Math.min(e.map_.maxZoom||100,e.map_.mapTypes[e.map_.getMapTypeId()].maxZoom),a=Math.min(Math.max(a,b),d);e.prevZoom_!=a&&(e.prevZoom_=a,e.resetViewport())});google.maps.event.addListener(this.map_,"idle",function(){e.redraw()});b&&(b.length||Object.keys(b).length)&&this.addMarkers(b,!1)}MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m";MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png";MarkerClusterer.prototype.extend=function(a,b){return function(a){for(var b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])};MarkerClusterer.prototype.onAdd=function(){this.setReady_(!0)};MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){if(!this.styles_.length)for(var a=0,b;b=this.sizes[a];a++)this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:b,width:b})};MarkerClusterer.prototype.fitMapToMarkers=function(){for(var a=this.getMarkers(),b=new google.maps.LatLngBounds,d=0,e;e=a[d];d++)b.extend(e.getPosition());this.map_.fitBounds(b)};MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.isAverageCenter=function(){return this.averageCenter_};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.calculator_=function(a,b){for(var d=0,e=a.length,f=e;0!==f;)f=parseInt(f/10,10),d++;d=Math.min(d,b);return{text:e,index:d}};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.addMarkers=function(a,b){if(a.length)for(var d=0,e;e=a[d];d++)this.pushMarkerTo_(e);else if(Object.keys(a).length)for(e in a)this.pushMarkerTo_(a[e]);b||this.redraw()};MarkerClusterer.prototype.pushMarkerTo_=function(a){a.isAdded=!1;if(a.draggable){var b=this;google.maps.event.addListener(a,"dragend",function(){a.isAdded=!1;b.repaint()})}this.markers_.push(a)};MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a);b||this.redraw()};MarkerClusterer.prototype.removeMarker_=function(a){var b=-1;if(this.markers_.indexOf)b=this.markers_.indexOf(a);else for(var d=0,e;e=this.markers_[d];d++)if(e==a){b=d;break}if(-1==b)return!1;a.setMap(null);this.markers_.splice(b,1);return!0};MarkerClusterer.prototype.removeMarker=function(a,b){var d=this.removeMarker_(a);return!b&&d?(this.resetViewport(),this.redraw(),!0):!1};MarkerClusterer.prototype.removeMarkers=function(a,b){for(var d=!1,e=0,f;f=a[e];e++)f=this.removeMarker_(f),d=d||f;if(!b&&d)return this.resetViewport(),this.redraw(),!0};MarkerClusterer.prototype.setReady_=function(a){this.ready_||(this.ready_=a,this.createClusters_())};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};MarkerClusterer.prototype.getMap=function(){return this.map_};MarkerClusterer.prototype.setMap=function(a){this.map_=a};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),d=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),e=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),d=b.fromLatLngToDivPixel(d);d.x+=this.gridSize_;d.y-=this.gridSize_;e=b.fromLatLngToDivPixel(e);e.x-=this.gridSize_;e.y+=this.gridSize_;d=b.fromDivPixelToLatLng(d);b=b.fromDivPixelToLatLng(e);a.extend(d);a.extend(b);return a};MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport(!0);this.markers_=[]};MarkerClusterer.prototype.resetViewport=function(a){for(var b=0,d;d=this.clusters_[b];b++)d.remove();for(b=0;d=this.markers_[b];b++)d.isAdded=!1,a&&d.setMap(null);this.clusters_=[]};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_.length=0;this.resetViewport();this.redraw();window.setTimeout(function(){for(var b=0,d;d=a[b];b++)d.remove()},0)};MarkerClusterer.prototype.redraw=function(){this.createClusters_()};MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,d=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2);return 12742*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))};MarkerClusterer.prototype.addToClosestCluster_=function(a){var b=4E4,d=null;a.getPosition();for(var e=0,f;f=this.clusters_[e];e++){var h=f.getCenter();h&&(h=this.distanceBetweenPoints_(h,a.getPosition()),h<b&&(b=h,d=f))}d&&d.isMarkerInClusterBounds(a)?d.addMarker(a):(f=new Cluster(this),f.addMarker(a),this.clusters_.push(f))};MarkerClusterer.prototype.createClusters_=function(){if(this.ready_)for(var a=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),a=this.getExtendedBounds(a),b=0,d;d=this.markers_[b];b++)!d.isAdded&&this.isMarkerInBounds_(d,a)&&this.addToClosestCluster_(d)};function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinClusterSize();this.averageCenter_=a.isAverageCenter();this.center_=null;this.markers_=[];this.bounds_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles(),a.getGridSize())}Cluster.prototype.isMarkerAlreadyAdded=function(a){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(a);for(var b=0,d;d=this.markers_[b];b++)if(d==a)return!0;return!1};Cluster.prototype.addMarker=function(a){if(this.isMarkerAlreadyAdded(a))return!1;if(!this.center_)this.center_=a.getPosition(),this.calculateBounds_();else if(this.averageCenter_){var b=this.markers_.length+1,d=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,b=(this.center_.lng()*(b-1)+a.getPosition().lng())/b;this.center_=new google.maps.LatLng(d,b);this.calculateBounds_()}a.isAdded=!0;this.markers_.push(a);d=this.markers_.length;d<this.minClusterSize_&&a.getMap()!=this.map_&&a.setMap(this.map_);if(d==this.minClusterSize_)for(b=0;b<d;b++)this.markers_[b].setMap(null);d>=this.minClusterSize_&&a.setMap(null);this.updateIcon();return!0};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){for(var a=new google.maps.LatLngBounds(this.center_,this.center_),b=this.getMarkers(),d=0,e;e=b[d];d++)a.extend(e.getPosition());return a};Cluster.prototype.remove=function(){this.clusterIcon_.remove();this.markers_.length=0;delete this.markers_};Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.updateIcon=function(){var a=this.map_.getZoom(),b=this.markerClusterer_.getMaxZoom();if(b&&a>b)for(a=0;b=this.markers_[a];a++)b.setMap(this.map_);else this.markers_.length<this.minClusterSize_?this.clusterIcon_.hide():(a=this.markerClusterer_.getStyles().length,a=this.markerClusterer_.getCalculator()(this.markers_,a),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(a),this.clusterIcon_.show())};function ClusterIcon(a,b,d){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.styles_=b;this.padding_=d||0;this.cluster_=a;this.center_=null;this.map_=a.getMap();this.sums_=this.div_=null;this.visible_=!1;this.setMap(this.map_)}ClusterIcon.prototype.triggerClusterClick=function(){var a=this.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"clusterclick",this.cluster_);a.isZoomOnClick()&&(a=this.map_.getZoom()+1,this.map_.fitBounds(this.cluster_.getBounds()),13<a?this.map_.setZoom(14):this.map_.setZoom(a))};ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement("DIV");if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.sums_.text}this.getPanes().overlayMouseTarget.appendChild(this.div_);var b=this;google.maps.event.addDomListener(this.div_,"click",function(){b.triggerClusterClick()})};ClusterIcon.prototype.getPosFromLatLng_=function(a){a=this.getProjection().fromLatLngToDivPixel(a);a.x-=parseInt(this.width_/2,10);a.y-=parseInt(this.height_/2,10);return a};ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px";this.div_.style.left=a.x+"px"}};ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.style.display=""}this.visible_=!0};ClusterIcon.prototype.remove=function(){this.setMap(null)};ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)};ClusterIcon.prototype.setSums=function(a){this.sums_=a;this.text_=a.text;this.index_=a.index;this.div_&&(this.div_.innerHTML=a.text);this.useStyle()};ClusterIcon.prototype.useStyle=function(){var a=Math.max(0,this.sums_.index-1),a=Math.min(this.styles_.length-1,a),a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.textColor_=a.textColor;this.anchor_=a.anchor;this.textSize_=a.textSize;this.backgroundPosition_=a.backgroundPosition;this.backgroundSize_=a.backgroundSize;this.fontFamily_=a.fontFamily};ClusterIcon.prototype.setCenter=function(a){this.center_=a};ClusterIcon.prototype.createCss=function(a){var b=[];b.push("background-image:url("+this.url_+");");var d=this.backgroundSize_?this.backgroundSize_:"0 0";b.push("background-position:"+(this.backgroundPosition_?this.backgroundPosition_:"0 0")+";");b.push("background-size:"+d+";");""!=this.fontFamily_&&b.push("font-family:"+this.fontFamily_+";");"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?b.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&this.anchor_[1]<this.width_?b.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):b.push("width:"+this.width_+"px; text-align:center;")):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");b.push("overflow:hidden; text-indent:50px;");b.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+(this.textColor_?this.textColor_:"black")+"; position:absolute; font-size:"+(this.textSize_?this.textSize_:11)+"px; ");return b.join("")};window.MarkerClusterer=MarkerClusterer;MarkerClusterer.prototype.addMarker=MarkerClusterer.prototype.addMarker;MarkerClusterer.prototype.addMarkers=MarkerClusterer.prototype.addMarkers;MarkerClusterer.prototype.clearMarkers=MarkerClusterer.prototype.clearMarkers;MarkerClusterer.prototype.fitMapToMarkers=MarkerClusterer.prototype.fitMapToMarkers;MarkerClusterer.prototype.getCalculator=MarkerClusterer.prototype.getCalculator;MarkerClusterer.prototype.getGridSize=MarkerClusterer.prototype.getGridSize;MarkerClusterer.prototype.getExtendedBounds=MarkerClusterer.prototype.getExtendedBounds;MarkerClusterer.prototype.getMap=MarkerClusterer.prototype.getMap;MarkerClusterer.prototype.getMarkers=MarkerClusterer.prototype.getMarkers;MarkerClusterer.prototype.getMaxZoom=MarkerClusterer.prototype.getMaxZoom;MarkerClusterer.prototype.getStyles=MarkerClusterer.prototype.getStyles;MarkerClusterer.prototype.getTotalClusters=MarkerClusterer.prototype.getTotalClusters;MarkerClusterer.prototype.getTotalMarkers=MarkerClusterer.prototype.getTotalMarkers;MarkerClusterer.prototype.redraw=MarkerClusterer.prototype.redraw;MarkerClusterer.prototype.removeMarker=MarkerClusterer.prototype.removeMarker;MarkerClusterer.prototype.removeMarkers=MarkerClusterer.prototype.removeMarkers;MarkerClusterer.prototype.resetViewport=MarkerClusterer.prototype.resetViewport;MarkerClusterer.prototype.repaint=MarkerClusterer.prototype.repaint;MarkerClusterer.prototype.setCalculator=MarkerClusterer.prototype.setCalculator;MarkerClusterer.prototype.setGridSize=MarkerClusterer.prototype.setGridSize;MarkerClusterer.prototype.setMaxZoom=MarkerClusterer.prototype.setMaxZoom;MarkerClusterer.prototype.onAdd=MarkerClusterer.prototype.onAdd;MarkerClusterer.prototype.draw=MarkerClusterer.prototype.draw;Cluster.prototype.getCenter=Cluster.prototype.getCenter;Cluster.prototype.getSize=Cluster.prototype.getSize;Cluster.prototype.getMarkers=Cluster.prototype.getMarkers;ClusterIcon.prototype.onAdd=ClusterIcon.prototype.onAdd;ClusterIcon.prototype.draw=ClusterIcon.prototype.draw;ClusterIcon.prototype.onRemove=ClusterIcon.prototype.onRemove;Object.keys=Object.keys||function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b};